---
title: "Risk to Return Comparison of an Investment Portfolio"
author: "Mahmutovic Dino & Milan Ivica"
date: "18 Februar 2020"
output: html_document
---


## Description

For this analysis the returns of five choosen companies were selected. Subsequently a equally weighted portfolio was created (equal investment in given five companies), and a risk (volatility) and return analysis was conducted. 


1. Data Manipulation

```{r }
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse, ggfortify, matrixStats,ggplot2, corrplot, datasets, lubridate)


#Load of Data
load('sp500_px.RData')
load('sp500_sym.RData')

#First Data Overview
sp500_company_returns <- sp500_px
#head(sp500_company_returns)

data_symbols <- sp500_sym
#head(data_symbols)

data <- read.csv("data/sp500_px.csv")


#Create Data Frame and remove NAs if existing
spdata <- as.data.frame(data)
spdata <- na.omit(spdata)
#head(spdata)

#Convert column X in Date format
spdata$X <- as.Date(spdata$X)

#Rename column X into "Date"
colnames(spdata)[1] <- "Date"


#Check for Min und Max Date

min_date <- min(spdata$Date)
min_date
max_date <- max(spdata$Date)
max_date

#New Overview od data frame
#head(spdata)

```

2 Visualization of Sample Data: 5 Companies choosen. Visualization of cumulated daily returns

```{r}

#Observation Period is 2009-12-31 to 2015-07-01

sample <- select(spdata, Date, MSFT, IBM, MCD, COST, AMZN) %>% 
  filter(Date >= as.Date("2009-12-31") & Date <= as.Date("2014-12-31"))



#Data Frame with Daily Returns

data_daily_returns <- sample


# Data Frame for cumulative returns
data_cumulated_returns <- data.frame(Date = sample$Date, MSFT_CUM = cumsum(sample$MSFT), 
                                                    IBM_CUM = cumsum(sample$IBM),
                                                    MCD_CUM = cumsum(sample$MCD),
                                                    COST_CUM = cumsum(sample$COST),
                                                    AMZN_CUM = cumsum(sample$AMZN))
head(data_cumulated_returns)


#plot cumulated returns of all companies

plot_all <- ggplot(data = data_cumulated_returns, aes(x = Date)) + 
          geom_line(aes(y = MSFT_CUM, color = "MSFT")) +
          geom_line(aes(y = IBM_CUM, color = "IBM")) +
          geom_line(aes(y = MCD_CUM, color = "MCD")) +
          geom_line(aes(y = COST_CUM, color = "COST")) +
          geom_line(aes(y = AMZN_CUM, color = "AMZN")) +
          scale_y_continuous("Cumulated Stock Returns")
        

plot_all

```



3 Generation of Model Portfolio

```{r}

#5 Companies: Equal investment of 20% in each company.

weight_equal <- c(0.2, 0.2, 0.2, 0.2, 0.2)

#Data Frame of equaly weighted daily returns
data_daily_we_adj <- data.frame(Date = sample$Date, 
                            MSFT_Weighted = sample$MSFT * weight_equal[1],
                            IBM_Weighted = sample$IBM * weight_equal[2],
                            MCD_Weighted = sample$MCD * weight_equal[3],
                            COST_Weighted = sample$COST * weight_equal[4],
                            AMZN_Weighted = sample$AMZN* weight_equal[5])

data_daily_weighted_equal <- data.frame(data_daily_we_adj, PORTF_Weighted_equal = (
                                                  data_daily_we_adj$MSFT_Weighted + 
                                                  data_daily_we_adj$IBM_Weighted +
                                                  data_daily_we_adj$MCD_Weighted +
                                                  data_daily_we_adj$COST_Weighted +
                                                  data_daily_we_adj$AMZN_Weighted
                                                  ))
                            
head(data_daily_weighted_equal)





#Cumulated returns of equally weighted portfolio
data_cumulated_portf_returns <- data.frame(Date = data_daily_weighted_equal$Date, PORTF_WEIGHTED_CUM = cumsum(data_daily_weighted_equal$PORTF_Weighted_equal))

head(data_cumulated_portf_returns)


#Data Frame: Cumulated return of all companies and investment portfolio (equal investments in each company)
data_cumulated_returns_ew_portf <- data.frame(data_cumulated_returns, data_cumulated_portf_returns$PORTF_WEIGHTED_CUM)
colnames(data_cumulated_returns_ew_portf)[7] <- "PORTF_WEIGHTED_CUM" # adjustment of name

head(data_cumulated_returns_ew_portf)



#Plot of all cumulated company returns and the equally weighted portfolio returns.
plot_all_ew_portf <- ggplot(data = data_cumulated_returns_ew_portf, aes(x = Date)) + 
          geom_line(aes(y = MSFT_CUM, color = "MSFT")) +
          geom_line(aes(y = IBM_CUM, color = "IBM")) +
          geom_line(aes(y = MCD_CUM, color = "MCD")) +
          geom_line(aes(y = COST_CUM, color = "COST")) +
          geom_line(aes(y = AMZN_CUM, color = "AMZN")) +
          geom_line(aes(y = PORTF_WEIGHTED_CUM, color = "PORTF_WEIGHTED_CUM")) +
          scale_y_continuous("Cumulated Stock Returns + Weighted Portf")
        

plot_all_ew_portf



```




- Review of correlations among company returns and volatiliy calculation (risk) for the investment portfolio

```{r}
#Correlation of 

correlations_matrix <- cor(data_daily_returns[,-c(0:1)])
correlations_matrix <- as.matrix(correlations_matrix)
print(correlations_matrix)


corrplot(correlations_matrix, method = 'circle', is.corr = FALSE)


#The correlation matrix/chart below suggests, that there is no negative correlation among the choosen companies. 
#The hightext correlation (0.44) is between MSFT and IBM. 
```


```{r}

#Covariance Matrix setup
covariance_matrix <- cov(data_daily_returns[,-c(0:1)])
covariance_matrix

#calculation of portfolio risk
portf_volatility_daily <- sqrt(t(weight_equal) %*% covariance_matrix %*% weight_equal)
portf_volatility_daily[1]


#assumption of 252 trading days p.a.
portf_volatility_annualized <- portf_volatility_daily[1]*sqrt(252)
portf_volatility_annualized


#Data frame for all daily returns, companies and portfolli
df_all_daily_returns <- data.frame(data_daily_returns,PORTF_Weighted_equal=(data_daily_weighted_equal$PORTF_Weighted_equal))
head(df_all_daily_returns)

#anualized portfolio volatilites of single companies
all_volatility_daily <- apply(df_all_daily_returns[,-c(0:1)],2,sd)
all_volatility_daily

#function to calculate annualized volatility given daily volatility
sqrt_time <- function(x) {x*sqrt(252)}

#Annualize daily company returns
company_volatility_annualized <- sapply(all_volatility_daily,sqrt_time)
company_volatility_annualized


#create data frame showing all volatilities
df_volatility <- data.frame(volatility=(company_volatility_annualized))
df_volatility

#Comments: The anualized volatility tabe below suggests, annualized portfolio risk is at 17%. Please consider high annualized volatility of Amazon and low volatility of Microsoft. 




```
- Visualization of all daily volatilites


```{r}

#Plot of all cumulated company returns and the equally weighted portfolio returns.

#Daily Returns: MSFT vs Equaly weighted Portfolio 
plot_volatility_mvp <- ggplot(data = df_all_daily_returns, aes(x = Date)) + 
          geom_line(aes(y = MSFT, color = "MSFT")) +
          geom_line(aes(y = PORTF_Weighted_equal, color = "PORTF_Weighted_equal")) +
          scale_y_continuous("Daily Returns: MSFT vs Portfolio") 
        
plot_volatility_mvp

#Equally weighted portfolo returns are much more volatile than msft returns

#Daily Returns: IBM vs Equaly weighted Portfolio 
plot_volatility_ivp <- ggplot(data = df_all_daily_returns, aes(x = Date)) + 
          geom_line(aes(y = IBM, color = "IBM")) +
          geom_line(aes(y = PORTF_Weighted_equal, color = "PORTF_Weighted_equal")) +
          scale_y_continuous("Daily Returns: IBM vs Portfolio") 
        
plot_volatility_ivp

#Equally weighted portfolo returns are less volatile than ibm returns


#Daily Returns: Amazonvs Equaly weighted Portfolio 
plot_volatility_avp <- ggplot(data = df_all_daily_returns, aes(x = Date)) + 
          geom_line(aes(y = IBM, color = "AMZN")) +
          geom_line(aes(y = PORTF_Weighted_equal, color = "PORTF_Weighted_equal")) +
          scale_y_continuous("Daily Returns: Amazon vs Portfolio") 
        
plot_volatility_avp

#Equally weighted portfolo returns are much less volatile than amazon returns




```


Analyzis of returns


```{r}
#function to anualize returns given 5 year observation period and assuming 252 trading days p.a.

head(df_all_daily_returns)

annual_ret_function <- function(x) {(1+sum(x)) ^ (252/(5*252)) -1}





#Test of annual_ret_function
#annual_ret_function(11.47530)
#test <- (1 + 0.6565716)^5 -1
#test

#Sum of daily returns
#all_returns_daily <- apply(df_all_daily_returns[,-c(0:1)],2,sum)
#all_returns_daily

all_returns_anualized <- apply(df_all_daily_returns[,-c(0:1)],2,annual_ret_function)
all_returns_anualized


#Fata Frame of annualized returs
#AAPL is NAN since value is negative
df_returns <- data.frame(returns=(all_returns_anualized))
df_returns

df_all <- data.frame(df_volatility, df_returns) 
df_all

names <- c('MSFT','IBM','MCD','COST','AMZN','PORTF_Weighted_equal')

df_all <- data.frame(Company = names, df_all)
df_all

plot(df_all$returns,df_all$volatility)

ggplot(data = df_all, mapping = aes(x= returns, y = volatility, color = Company)) +
  geom_point()



#Return Distributions

head(df_all_daily_returns)

df_all_daily_returns %>% 
  ggplot(aes(x = PORTF_Weighted_equal, color = 'PORTF_Weighted_equal')) + 
  stat_density(geom = "line", alpha = 1) +
  
  ggtitle("Portfolio Monthly Returns 2010 - 2014") +
  xlab("daily returns") +
  ylab("distribution") 


#The Results display the risk to return ratio of choosen companies and a portfolio (equally invested) consisting of the same companies. The goal would be to find the portfolio weights, which optimize the risk to return ratio and thus demonstrate the benefits of diversification. This optimization could be a subject for a further assignment. 

```

